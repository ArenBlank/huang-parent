# 健身平台完整接口测试文档

**文档版本**: v2.0
**最后更新**: 2025-10-16
**项目架构**: Spring Boot 3.0.5 + MyBatis-Plus 3.5.3.1
**API文档**: Knife4j (基于OpenAPI 3.0)

---

## 📋 目录导航

- [快速开始](#快速开始)
- [服务端口与访问地址](#服务端口与访问地址)
- [测试账号](#测试账号)
- [App端接口测试](#app端接口测试)
- [Admin端接口测试](#admin端接口测试)
- [完整业务流程测试](#完整业务流程测试)
- [注意事项](#注意事项)
- [常见问题FAQ](#常见问题faq)

---

## 快速开始

### 1. 启动服务

```bash
# 确保MySQL、Redis、MinIO已启动

# 启动Admin端 (端口8080)
cd web/web-admin
mvn spring-boot:run

# 启动App端 (端口8081)
cd web/web-app
mvn spring-boot:run
```

### 2. 访问API文档

- **管理端**: http://localhost:8080/doc.html
- **用户端**: http://localhost:8081/doc.html

### 3. 设置JWT认证

1. 先调用登录接口获取token
2. 点击页面右上角 🔒 **Authorize** 按钮
3. 输入token (不需要Bearer前缀)
4. 点击确认

---

## 服务端口与访问地址

| 服务 | 端口 | Knife4j文档 | 说明 |
|------|------|-------------|------|
| **Admin端** | 8080 | http://localhost:8080/doc.html | 管理后台接口 |
| **App端** | 8081 | http://localhost:8081/doc.html | 用户端接口 |
| **MySQL** | 3306 | - | 数据库 |
| **Redis** | 6379 | - | 缓存/Session |
| **MinIO** | 9000 | http://localhost:9001 | 对象存储 |

---

## 测试账号

### 管理员账号
```
用户名: admin
密码: 123456
角色: 管理员
```

### 普通用户
```
用户名: user001
密码: 123456
手机号: 13800138001
角色: 普通会员
```

### 教练账号
```
用户名: coach001
密码: 123456
手机号: 13900139001
角色: 教练
```

### VIP用户
```
用户名: user002
密码: 123456
手机号: 13800138002
角色: VIP会员
```

---

## 🚀 App端接口测试

### 模块01：用户认证 (无需Token)

#### 1.1 发送短信验证码
- **接口**: `POST /app/auth/sms-code/send`
- **分组**: 用户认证
- **认证**: 无需Token
- **请求示例**:
```json
{
  "phone": "13800138888",
  "type": "register"
}
```
- **验证码类型**:
  - `register` - 注册
  - `login` - 登录
  - `reset_password` - 重置密码
  - `cancel_account` - 注销账号
- **【开发模式】**: 验证码功能已暂停,统一返回固定验证码 `123456`
- **限制**: 同一手机号60秒内只能发送一次

#### 1.2 用户注册
- **接口**: `POST /app/auth/register`
- **认证**: 无需Token
- **前置条件**: 先发送注册验证码
- **请求示例**:
```json
{
  "username": "testuser888",
  "password": "123456",
  "confirmPassword": "123456",
  "phone": "13800138888",
  "smsCode": "123456",
  "nickname": "新用户昵称"
}
```
- **返回**: 用户ID和基本信息
- **注意**: 用户名和手机号必须唯一

#### 1.3 密码登录
- **接口**: `POST /app/auth/login`
- **认证**: 无需Token
- **请求示例**:
```json
{
  "account": "13800138001",
  "loginType": "password",
  "password": "123456",
  "deviceId": "web_device_001",
  "deviceType": "web"
}
```
- **支持的登录方式**:
  - `password` - 密码登录
  - `sms` - 短信验证码登录
- **账号格式**: 支持用户名、手机号、邮箱
- **返回**: JWT Token (有效期24小时)

#### 1.4 短信验证码登录

**第一步**: 发送登录验证码
```json
{
  "phone": "13800138001",
  "type": "login"
}
```

**第二步**: 验证码登录
```json
{
  "account": "13800138001",
  "loginType": "sms",
  "smsCode": "123456",
  "deviceId": "web_device_001",
  "deviceType": "web"
}
```

#### 1.5 忘记密码

**第一步**: 发送重置密码验证码
```json
{
  "phone": "13800138001",
  "type": "reset_password"
}
```

**第二步**: 重置密码
- **接口**: `POST /app/auth/forget-password`
```json
{
  "phone": "13800138001",
  "smsCode": "123456",
  "newPassword": "newpass123",
  "confirmPassword": "newpass123"
}
```

#### 1.6 退出登录
- **接口**: `POST /app/auth/logout`
- **认证**: 需要Bearer Token
- **说明**: 将Token加入黑名单,Token立即失效

---

### 模块02：个人信息管理 🔐

> **重要**: 以下接口需要JWT认证,请先登录获取token

#### 2.1 获取个人信息
- **接口**: `GET /app/profile/info`
- **认证**: Bearer Token
- **返回数据**:
```json
{
  "id": 1,
  "username": "user001",
  "nickname": "健身爱好者",
  "phone": "13800138001",
  "email": "user@example.com",
  "avatar": "http://localhost:9000/avatar/xxx.jpg",
  "gender": 1,
  "birthDate": "1990-01-01",
  "height": 175.5,
  "weight": 70.0,
  "bio": "热爱健身",
  "profileCompleteness": 85
}
```

#### 2.2 修改个人信息
- **接口**: `PUT /app/profile/info`
- **认证**: Bearer Token
- **请求示例**:
```json
{
  "nickname": "健身达人",
  "email": "newemail@example.com",
  "gender": 1,
  "birthDate": "1990-05-15",
  "bio": "热爱健身,追求健康生活",
  "height": 178.0,
  "weight": 75.0,
  "occupation": "程序员",
  "address": "北京市朝阳区"
}
```

#### 2.3 上传头像
- **接口**: `POST /app/profile/avatar/upload`
- **认证**: Bearer Token
- **请求方式**: multipart/form-data
- **参数**: `file` (图片文件)
- **限制**:
  - 文件大小: 最大5MB
  - 文件格式: jpg/jpeg/png/gif
- **返回**: 头像URL

#### 2.4 修改密码
- **接口**: `PUT /app/profile/password`
- **认证**: Bearer Token
- **请求示例**:
```json
{
  "oldPassword": "123456",
  "newPassword": "newpass123",
  "confirmPassword": "newpass123"
}
```
- **注意**: 修改成功后需要重新登录

#### 2.5 申请账号注销

**第一步**: 发送注销验证码
```json
{
  "phone": "13800138001",
  "type": "cancel_account"
}
```

**第二步**: 提交注销申请
- **接口**: `POST /app/profile/cancel`
- **认证**: Bearer Token
- **请求示例**:
```json
{
  "cancelType": "temporary",
  "reason": "暂时不使用了",
  "password": "123456",
  "smsCode": "123456"
}
```
- **注销类型**:
  - `temporary` - 临时注销 (7天后生效,可撤销)
  - `permanent` - 永久注销 (30天后生效,可撤销)

#### 2.6 撤销注销申请
- **接口**: `POST /app/profile/cancel/{cancelId}/revoke`
- **认证**: Bearer Token
- **说明**: 只有待审核状态可以撤销

#### 2.7 获取账号统计信息
- **接口**: `GET /app/profile/statistics`
- **认证**: Bearer Token
- **返回**: 积分、VIP等级、课程数、咨询数等

---

### 模块03：角色管理 🔐

#### 3.1 获取当前用户角色列表
- **接口**: `GET /app/role/list`
- **认证**: Bearer Token
- **返回**: 用户拥有的所有角色

#### 3.2 获取角色详情
- **接口**: `GET /app/role/{roleId}`
- **认证**: Bearer Token
- **返回**: 角色名称、编码、描述等

---

### 模块04：教练认证申请 🔐

#### 4.1 检查申请资格
- **接口**: `GET /app/coach/certification/check-eligibility`
- **认证**: Bearer Token
- **返回示例**:
```json
{
  "eligible": true,
  "reason": "符合申请条件"
}
```

#### 4.2 提交教练认证申请
- **接口**: `POST /app/coach/certification/apply`
- **认证**: Bearer Token
- **请求示例**:
```json
{
  "realName": "张三",
  "idCard": "110101199001011234",
  "phone": "13800138001",
  "email": "coach@example.com",
  "specialties": "瑜伽、普拉提、力量训练",
  "experienceYears": 5,
  "introduction": "5年健身教练经验,擅长瑜伽和普拉提",
  "certificates": [
    {
      "name": "国家健身教练资格证",
      "issueOrg": "国家体育总局",
      "issueDate": "2018-06-01",
      "imageUrl": "/uploads/cert1.jpg"
    }
  ],
  "education": [
    {
      "school": "北京体育大学",
      "major": "运动训练",
      "degree": "本科",
      "startDate": "2010-09-01",
      "endDate": "2014-06-30"
    }
  ],
  "workExperience": [
    {
      "company": "XX健身中心",
      "position": "高级教练",
      "startDate": "2014-07-01",
      "endDate": "2023-12-31",
      "description": "负责私教课程和团体课程"
    }
  ]
}
```

#### 4.3 获取当前申请状态
- **接口**: `GET /app/coach/certification/current`
- **认证**: Bearer Token
- **返回**: 最新的认证申请状态

#### 4.4 获取申请历史记录
- **接口**: `GET /app/coach/certification/history`
- **认证**: Bearer Token
- **返回**: 所有历史申请记录

#### 4.5 取消申请
- **接口**: `DELETE /app/coach/certification/{applicationId}/cancel`
- **认证**: Bearer Token
- **参数**: `cancelReason` (可选)
- **限制**: 只有待审核状态可以取消

---

### 模块05：教练离职管理 🔐

> **前置条件**: 必须是已认证的教练

#### 5.1 提交教练离职申请
- **接口**: `POST /app/coach/resignation/apply`
- **认证**: Bearer Token
- **请求示例**:
```json
{
  "resignationDate": "2025-03-15",
  "reason": "个人发展原因,需要换工作",
  "handoverPlan": "将所有在约课程交接给李教练,预计3天完成交接"
}
```
- **参数说明**:
  - `resignationDate`: 预计离职日期,必须是未来日期
  - `reason`: 离职原因,必填,最多500字
  - `handoverPlan`: 工作交接计划,可选,最多1000字

#### 5.2 获取当前离职申请状态
- **接口**: `GET /app/coach/resignation/current-status`
- **认证**: Bearer Token
- **返回**: 当前是否有待审核的离职申请

#### 5.3 获取离职申请历史
- **接口**: `GET /app/coach/resignation/history`
- **认证**: Bearer Token
- **返回**: 所有历史离职申请,按申请时间降序

#### 5.4 获取离职申请详情
- **接口**: `GET /app/coach/resignation/{applicationId}`
- **认证**: Bearer Token
- **返回**: 申请详情及审核结果

#### 5.5 撤销离职申请
- **接口**: `DELETE /app/coach/resignation/{applicationId}/cancel`
- **认证**: Bearer Token
- **限制**: 只有待审核状态可以撤销

---

### 模块06：教练咨询 🔐

> **说明**: 普通用户预约教练咨询

#### 6.1 预约教练咨询
- **接口**: `POST /app/consultation/book`
- **认证**: Bearer Token
- **请求示例**:
```json
{
  "coachId": 1,
  "consultationType": "online",
  "consultationDate": "2025-02-20 14:00:00",
  "duration": 60,
  "topic": "减脂训练计划咨询",
  "content": "想咨询如何科学减脂,制定合适的训练计划"
}
```
- **参数说明**:
  - `consultationType`: `online`在线 / `offline`线下
  - `consultationDate`: 咨询时间,必须是未来时间
  - `duration`: 咨询时长(分钟),最少30分钟
  - `topic`: 咨询主题,必填
  - `content`: 咨询内容,可选

#### 6.2 查看我的咨询记录
- **接口**: `GET /app/consultation/my-list`
- **认证**: Bearer Token
- **查询参数**:
  - `status`: 状态筛选 - `scheduled`已预约 / `completed`已完成 / `cancelled`已取消
- **示例**:
```
GET /app/consultation/my-list?status=scheduled
```

#### 6.3 获取咨询详情
- **接口**: `GET /app/consultation/{id}`
- **认证**: Bearer Token
- **返回**: 咨询详情、教练建议等

#### 6.4 取消咨询
- **接口**: `DELETE /app/consultation/{id}/cancel`
- **认证**: Bearer Token
- **限制**: 只有scheduled状态可以取消

---

### 模块07：教练日程管理 🔐

> **前置条件**: 必须是已认证的教练

#### 7.1 查看我的工作时间安排
- **接口**: `GET /app/coach/schedule/availability/list`
- **认证**: Bearer Token
- **返回**: 一周工作时间安排(周一到周日)

#### 7.2 设置我的工作时间
- **接口**: `POST /app/coach/schedule/availability/set`
- **认证**: Bearer Token
- **请求示例**:
```json
{
  "dayOfWeek": 1,
  "startTime": "09:00:00",
  "endTime": "18:00:00",
  "isAvailable": 1
}
```
- **参数说明**:
  - `dayOfWeek`: 1-7 (1=周一,7=周日)
  - `startTime`: 开始时间(HH:mm:ss)
  - `endTime`: 结束时间(HH:mm:ss)
  - `isAvailable`: 1=可用, 0=不可用

#### 7.3 删除工作时间设置
- **接口**: `DELETE /app/coach/schedule/availability/{id}`
- **认证**: Bearer Token

#### 7.4 申请日程调整
- **接口**: `POST /app/coach/schedule/change/apply`
- **认证**: Bearer Token
- **请求示例**:
```json
{
  "changeType": "leave",
  "originalDate": "2025-02-18",
  "originalStartTime": "09:00:00",
  "originalEndTime": "12:00:00",
  "reason": "家中有事需要请假半天"
}
```
- **变更类型**:
  - `leave`: 请假
  - `overtime`: 加班
  - `adjust`: 调整

#### 7.5 查看我的日程调整申请
- **接口**: `GET /app/coach/schedule/change/page`
- **认证**: Bearer Token
- **查询参数**:
  - `current`: 当前页码
  - `size`: 每页大小
  - `status`: pending/approved/rejected
  - `changeType`: leave/overtime/adjust

#### 7.6 查看日程调整申请详情
- **接口**: `GET /app/coach/schedule/change/{id}`
- **认证**: Bearer Token

#### 7.7 取消日程调整申请
- **接口**: `DELETE /app/coach/schedule/change/{id}`
- **认证**: Bearer Token
- **限制**: 只能取消待审核状态

---

### 模块08：门店信息 🔐

#### 8.1 分页查询门店列表
- **接口**: `GET /app/gym-store/page`
- **认证**: 无需Token
- **查询参数**:
  - `current`: 当前页码(默认1)
  - `size`: 每页大小(默认10)
  - `storeName`: 门店名称(模糊查询)
  - `address`: 地址(模糊查询)
  - `status`: 状态(1=营业, 0=停业, 2=装修中)
- **返回**: 只返回营业中的门店

#### 8.2 查询门店详情
- **接口**: `GET /app/gym-store/{id}`
- **认证**: 无需Token
- **参数**:
  - `id`: 门店ID
  - `userLatitude`: 用户纬度(可选)
  - `userLongitude`: 用户经度(可选)
- **返回**: 门店详情,如果提供位置会计算距离
- **示例**:
```
GET /app/gym-store/1?userLatitude=39.9042&userLongitude=116.4074
```

#### 8.3 查询附近门店
- **接口**: `GET /app/gym-store/nearby`
- **认证**: 无需Token
- **参数**:
  - `userLatitude`: 用户纬度(必填)
  - `userLongitude`: 用户经度(必填)
  - `radius`: 搜索半径(公里),默认5,最大50
- **返回**: 附近营业中的门店,按距离排序
- **示例**:
```
GET /app/gym-store/nearby?userLatitude=39.9042&userLongitude=116.4074&radius=10
```

#### 8.4 搜索门店
- **接口**: `GET /app/gym-store/search`
- **认证**: 无需Token
- **参数**:
  - `keyword`: 搜索关键词(搜索名称和地址)
  - `current`: 当前页码(默认1)
  - `size`: 每页大小(默认10)
- **示例**:
```
GET /app/gym-store/search?keyword=朝阳&current=1&size=10
```

#### 8.5 查询门店的教练列表
- **接口**: `GET /app/gym-store/{id}/coaches`
- **认证**: 无需Token
- **返回**: 门店的所有在职教练,按评分排序

#### 8.6 查询门店的课程排期
- **接口**: `GET /app/gym-store/{id}/courses`
- **认证**: 无需Token
- **返回**: 门店今日及未来的课程排期

---

## 🛠️ Admin端接口测试

### 模块01：用户管理

#### 1.1 用户账号注销申请管理

##### 1.1.1 获取注销申请列表
- **接口**: `GET /admin/user-account-cancel/list`
- **分组**: 用户管理
- **参数**:
  - `pageNum`: 页码(默认1)
  - `pageSize`: 每页数量(默认10)
  - `status`: 状态筛选(pending/approved/rejected/cancelled)
  - `username`: 用户名搜索
  - `phone`: 手机号搜索

##### 1.1.2 获取注销申请详情
- **接口**: `GET /admin/user-account-cancel/{id}`
- **参数**: 申请ID

##### 1.1.3 审核注销申请
- **接口**: `PUT /admin/user-account-cancel/{id}/review`
- **请求示例**:
```json
{
  "reviewStatus": "approved",
  "reviewRemark": "审核通过,同意注销申请"
}
```

##### 1.1.4 获取待审核数量
- **接口**: `GET /admin/user-account-cancel/pending-count`
- **返回**: 待审核的注销申请数量

---

### 模块02：教练管理

#### 2.1 教练认证申请管理

##### 2.1.1 分页查询教练认证申请列表
- **接口**: `GET /admin/coach/certification/list`
- **参数**:
  - `page`: 页码(默认1)
  - `size`: 每页大小(默认10)
  - `realName`: 真实姓名搜索
  - `phone`: 联系电话搜索
  - `status`: 状态筛选(pending/approved/rejected)
  - `specialties`: 专长领域搜索
  - `startTime`: 申请开始时间
  - `endTime`: 申请结束时间
  - `sortOrder`: 排序方式(asc/desc)

##### 2.1.2 获取教练认证申请详情
- **接口**: `GET /admin/coach/certification/detail/{id}`

##### 2.1.3 审核教练认证申请
- **接口**: `PUT /admin/coach/certification/review`
- **请求示例**:
```json
{
  "id": 1,
  "status": "approved",
  "reviewRemark": "申请材料齐全,符合认证要求",
  "certificationNo": "COACH202501240001"
}
```

##### 2.1.4 快捷批准
- **接口**: `PUT /admin/coach/certification/{id}/approve`
- **参数**:
  - `id`: 申请ID
  - `reviewRemark`: 审核备注(可选)

##### 2.1.5 快捷拒绝
- **接口**: `PUT /admin/coach/certification/{id}/reject`
- **参数**:
  - `id`: 申请ID
  - `reviewRemark`: 拒绝原因(必填)

#### 2.2 教练离职申请管理

##### 2.2.1 获取离职申请列表
- **接口**: `GET /admin/coach/resignation/list`
- **参数**:
  - `current`: 当前页码
  - `size`: 每页大小
  - `coachId`: 教练ID
  - `coachName`: 教练姓名
  - `status`: 状态筛选
  - `applyStartDate`: 申请开始时间
  - `applyEndDate`: 申请结束时间

##### 2.2.2 查看离职申请详情
- **接口**: `GET /admin/coach/resignation/{id}`

##### 2.2.3 批准离职申请
- **接口**: `POST /admin/coach/resignation/approve/{id}`
- **请求示例**:
```json
{
  "reviewRemark": "同意离职申请,感谢您的贡献",
  "actualLeaveDate": "2025-03-10"
}
```

##### 2.2.4 拒绝离职申请
- **接口**: `POST /admin/coach/resignation/reject/{id}`
- **请求示例**:
```json
{
  "reviewRemark": "当前项目需要您,请再考虑一下"
}
```

##### 2.2.5 取消离职申请
- **接口**: `DELETE /admin/coach/resignation/cancel/{id}`
- **参数**: `cancelReason`(可选)

#### 2.3 教练咨询记录管理

##### 2.3.1 分页查询咨询记录
- **接口**: `GET /admin/coach-consultation/page`
- **参数**:
  - `current`: 当前页码
  - `size`: 每页大小
  - `coachId`: 教练ID
  - `userId`: 用户ID
  - `consultationType`: online/offline
  - `status`: scheduled/completed/cancelled
  - `startDate`: 开始日期
  - `endDate`: 结束日期

##### 2.3.2 获取咨询详情
- **接口**: `GET /admin/coach-consultation/{id}`

##### 2.3.3 更新咨询状态
- **接口**: `PUT /admin/coach-consultation/{id}/status`
- **参数**: `status` (scheduled/completed/cancelled)

##### 2.3.4 添加教练建议
- **接口**: `PUT /admin/coach-consultation/{id}/advice`
- **参数**: `coachAdvice` (教练建议)

##### 2.3.5 获取教练咨询统计
- **接口**: `GET /admin/coach-consultation/coach/{coachId}/stats`

##### 2.3.6 获取用户咨询历史
- **接口**: `GET /admin/coach-consultation/user/{userId}/history`

##### 2.3.7 获取咨询统计数据
- **接口**: `GET /admin/coach-consultation/statistics`

##### 2.3.8 批量删除咨询记录
- **接口**: `DELETE /admin/coach-consultation/batch`
- **请求体**: `[1, 2, 3, 4, 5]`

#### 2.4 教练日程审核管理

##### 2.4.1 分页查询日程变更申请
- **接口**: `GET /admin/coach/schedule/change/page`
- **参数**:
  - `current`: 当前页码
  - `size`: 每页大小
  - `coachId`: 教练ID
  - `coachName`: 教练姓名
  - `status`: pending/approved/rejected
  - `changeType`: leave/overtime/adjust

##### 2.4.2 查询日程变更申请详情
- **接口**: `GET /admin/coach/schedule/change/{id}`

##### 2.4.3 审核日程变更申请
- **接口**: `POST /admin/coach/schedule/change/review`
- **请求示例**:
```json
{
  "id": 1,
  "status": "approved",
  "reviewRemark": "同意请假申请"
}
```

---

### 模块03：门店管理

#### 3.1 分页查询门店列表
- **接口**: `GET /admin/gym-store/page`
- **参数**:
  - `current`: 当前页码
  - `size`: 每页大小
  - `storeName`: 门店名称
  - `storeCode`: 门店编码
  - `address`: 地址
  - `status`: 状态(0=停业, 1=营业, 2=装修中)

#### 3.2 查询门店详情
- **接口**: `GET /admin/gym-store/{id}`
- **返回**: 门店详情+教练统计+会员统计+课程统计

#### 3.3 新增门店
- **接口**: `POST /admin/gym-store`
- **请求示例**:
```json
{
  "storeName": "健身中心海淀店",
  "storeCode": "STORE003",
  "address": "北京市海淀区中关村大街1号",
  "city": "北京市",
  "district": "海淀区",
  "latitude": 39.9833,
  "longitude": 116.3163,
  "phone": "010-88888888",
  "businessHours": "周一至周日 06:00-23:00",
  "facilities": "跑步机、动感单车、瑜伽房、游泳池、淋浴间",
  "description": "位于中关村核心区域",
  "images": ["http://xxx.jpg", "http://yyy.jpg"],
  "status": 1
}
```

#### 3.4 更新门店信息
- **接口**: `PUT /admin/gym-store`
- **请求示例**: 同新增门店,需要包含id字段

#### 3.5 删除门店
- **接口**: `DELETE /admin/gym-store/{id}`
- **说明**: 逻辑删除

#### 3.6 批量删除门店
- **接口**: `DELETE /admin/gym-store/batch`
- **请求体**: `[1, 2, 3]`

#### 3.7 修改门店状态
- **接口**: `PUT /admin/gym-store/{id}/status`
- **参数**: `status` (0=停业, 1=营业, 2=装修中)

#### 3.8 查询门店统计数据
- **接口**: `GET /admin/gym-store/statistics`
- **返回**: 总门店数、营业中数量、停业数量等

#### 3.9 查询门店的教练列表
- **接口**: `GET /admin/gym-store/{id}/coaches`

#### 3.10 查询门店的课程列表
- **接口**: `GET /admin/gym-store/{id}/courses`

#### 3.11 上传门店图片
- **接口**: `POST /admin/gym-store/upload-image`
- **请求方式**: multipart/form-data
- **参数**: `file` (图片文件)
- **限制**: 最大10MB, 支持jpg/png/jpeg
- **返回**: 图片URL

---

### 模块04：统计管理

#### 4.1 获取账号统计信息
- **接口**: `GET /admin/statistics/account`
- **返回示例**:
```json
{
  "totalUsers": 12,
  "activeUsers": 12,
  "todayNewUsers": 0,
  "todayLoginUsers": 5,
  "todayLogins": 8,
  "weekNewUsers": 2,
  "monthNewUsers": 3,
  "normalMembers": 4,
  "vipMembers": 3,
  "coachCount": 5
}
```

#### 4.2 手动执行课程统计任务
- **接口**: `POST /admin/statistics/task/course`
- **说明**: 统计前一天的课程数据
- **定时配置**: 每天凌晨1点自动执行

#### 4.3 手动执行教练统计任务
- **接口**: `POST /admin/statistics/task/coach`
- **说明**: 统计前一天的教练工作数据
- **定时配置**: 每天凌晨2点自动执行

#### 4.4 手动执行课程状态检查任务
- **接口**: `POST /admin/statistics/task/course-status`
- **说明**: 将已结束的课程更新为"已结束"状态
- **定时配置**: 每小时整点自动执行

#### 4.5 手动执行临时文件清理任务
- **接口**: `POST /admin/statistics/task/clean-temp-files`
- **说明**: 清理过期的临时文件
- **定时配置**: 每天凌晨3点自动执行

---

### 模块05：权限管理

#### 5.1 根据角色ID查询权限列表
- **接口**: `GET /admin/permission/role/{roleId}`
- **示例**: `GET /admin/permission/role/1`
- **返回**: 角色拥有的所有权限

#### 5.2 根据用户ID查询权限列表
- **接口**: `GET /admin/permission/user/{userId}`
- **示例**: `GET /admin/permission/user/1`
- **返回**: 用户通过角色获得的所有权限

#### 5.3 检查用户是否有指定权限
- **接口**: `GET /admin/permission/check`
- **参数**:
  - `userId`: 用户ID
  - `permissionCode`: 权限编码
- **示例**: `GET /admin/permission/check?userId=1&permissionCode=user:add`
- **返回**: `true` / `false`

---

## 📝 完整业务流程测试

### 流程一：新用户注册到教练认证

#### 步骤1：用户注册
1. **发送注册验证码**: `POST /app/auth/sms-code/send`
```json
{
  "phone": "13900139888",
  "type": "register"
}
```

2. **用户注册**: `POST /app/auth/register`
```json
{
  "username": "newcoach888",
  "password": "123456",
  "confirmPassword": "123456",
  "phone": "13900139888",
  "smsCode": "123456",
  "nickname": "新教练"
}
```

3. **登录获取Token**: `POST /app/auth/login`
```json
{
  "account": "13900139888",
  "loginType": "password",
  "password": "123456",
  "deviceId": "web_001",
  "deviceType": "web"
}
```

#### 步骤2：完善个人信息
4. **修改个人信息**: `PUT /app/profile/info`
```json
{
  "nickname": "健身达人",
  "email": "coach@example.com",
  "gender": 1,
  "birthDate": "1990-05-15",
  "bio": "热爱健身",
  "height": 178.0,
  "weight": 75.0
}
```

5. **上传头像**: `POST /app/profile/avatar/upload`

#### 步骤3：申请教练认证
6. **检查申请资格**: `GET /app/coach/certification/check-eligibility`

7. **提交教练认证申请**: `POST /app/coach/certification/apply`
```json
{
  "realName": "王教练",
  "idCard": "110101199005151234",
  "phone": "13900139888",
  "email": "coach@example.com",
  "specialties": "力量训练、功能性训练",
  "experienceYears": 3,
  "introduction": "3年健身教练经验",
  "certificates": [
    {
      "name": "国家健身教练资格证",
      "issueOrg": "国家体育总局",
      "issueDate": "2020-06-01",
      "imageUrl": "/uploads/cert.jpg"
    }
  ]
}
```

#### 步骤4：Admin端审核
8. **查看待审核申请**: `GET /admin/coach/certification/list?status=pending`

9. **批准认证申请**: `PUT /admin/coach/certification/1/approve?reviewRemark=审核通过`

#### 步骤5：教练设置工作日程
10. **设置周一工作时间**: `POST /app/coach/schedule/availability/set`
```json
{
  "dayOfWeek": 1,
  "startTime": "09:00:00",
  "endTime": "18:00:00",
  "isAvailable": 1
}
```

---

### 流程二：用户预约教练咨询

#### 步骤1：用户登录
1. **用户登录**: `POST /app/auth/login`

#### 步骤2：查看门店和教练
2. **查询附近门店**: `GET /app/gym-store/nearby?userLatitude=39.9042&userLongitude=116.4074&radius=10`

3. **查询门店的教练列表**: `GET /app/gym-store/1/coaches`

#### 步骤3：预约教练咨询
4. **预约教练咨询**: `POST /app/consultation/book`
```json
{
  "coachId": 1,
  "consultationType": "online",
  "consultationDate": "2025-02-20 14:00:00",
  "duration": 60,
  "topic": "减脂训练计划咨询",
  "content": "想咨询如何科学减脂"
}
```

5. **查看我的咨询记录**: `GET /app/consultation/my-list?status=scheduled`

#### 步骤4：Admin端管理咨询
6. **查看所有咨询**: `GET /admin/coach-consultation/page`

7. **添加教练建议**: `PUT /admin/coach-consultation/1/advice?coachAdvice=建议每周3次力量训练+2次有氧`

8. **更新状态为已完成**: `PUT /admin/coach-consultation/1/status?status=completed`

---

### 流程三：教练日程变更审核

#### 步骤1：教练申请日程变更
1. **教练登录**: `POST /app/auth/login`

2. **提交请假申请**: `POST /app/coach/schedule/change/apply`
```json
{
  "changeType": "leave",
  "originalDate": "2025-02-18",
  "originalStartTime": "09:00:00",
  "originalEndTime": "12:00:00",
  "reason": "家中有事需要请假"
}
```

3. **查看申请记录**: `GET /app/coach/schedule/change/page?status=pending`

#### 步骤2：Admin端审核
4. **查看待审核申请**: `GET /admin/coach/schedule/change/page?status=pending`

5. **批准申请**: `POST /admin/coach/schedule/change/review`
```json
{
  "id": 1,
  "status": "approved",
  "reviewRemark": "同意请假"
}
```

---

### 流程四：教练离职申请

#### 步骤1：教练提交离职申请
1. **教练登录**: `POST /app/auth/login`

2. **提交离职申请**: `POST /app/coach/resignation/apply`
```json
{
  "resignationDate": "2025-03-15",
  "reason": "个人发展原因",
  "handoverPlan": "将所有会员课程交接给张教练"
}
```

3. **查看当前申请状态**: `GET /app/coach/resignation/current-status`

#### 步骤2：Admin端审核
4. **查看离职申请列表**: `GET /admin/coach/resignation/list?status=pending`

5. **批准离职申请**: `POST /admin/coach/resignation/approve/1`
```json
{
  "reviewRemark": "同意离职申请,感谢您的贡献",
  "actualLeaveDate": "2025-03-10"
}
```

---

### 流程五：统计管理与权限验证

#### 步骤1：查看统计数据
1. **Admin登录**: 登录Admin端

2. **查看账号统计**: `GET /admin/statistics/account`

3. **查看门店统计**: `GET /admin/gym-store/statistics`

#### 步骤2：手动触发定时任务
4. **执行课程统计**: `POST /admin/statistics/task/course`

5. **执行教练统计**: `POST /admin/statistics/task/coach`

6. **检查课程状态**: `POST /admin/statistics/task/course-status`

7. **清理临时文件**: `POST /admin/statistics/task/clean-temp-files`

#### 步骤3：权限管理验证
8. **查询管理员角色权限**: `GET /admin/permission/role/1`

9. **查询指定用户权限**: `GET /admin/permission/user/1`

10. **检查用户权限**: `GET /admin/permission/check?userId=1&permissionCode=user:add`

---

## ⚠️ 注意事项

### 1. JWT认证
- App端所有需要认证的接口(标记🔐)都需要先登录获取token
- 在Knife4j界面右上角点击🔒设置认证
- Token有效期为24小时,过期需要重新登录
- Token格式: Bearer {token值}

### 2. 验证码
- **【开发模式】**: 验证码功能已暂停,所有验证码统一为 `123456`
- 验证码有效期为5分钟
- 同一手机号60秒内只能发送一次

### 3. 教练认证流程
- 用户必须先注册并完善个人信息
- 提交认证申请后需要Admin审核
- 审核通过后系统自动创建教练账号并分配教练角色
- 认证被拒绝后可以重新申请

### 4. 教练咨询功能
- 咨询时间必须是未来时间
- 咨询时长最少30分钟
- 只有scheduled状态的咨询可以取消
- 咨询完成后可以添加教练建议

### 5. 教练日程管理
- 只有认证教练才能设置工作日程
- dayOfWeek: 1-7 (1=周一, 7=周日)
- 时间格式: HH:mm:ss
- 只有待审核状态的日程变更可以取消

### 6. 教练离职申请
- 只有教练身份的用户才能提交离职申请
- 离职日期必须是未来日期
- 只有待审核状态的申请可以撤销
- 同一时间只能有一个待审核的离职申请
- Admin批准离职后,教练状态更新为离职,角色被移除

### 7. 门店管理
- App端只能查询营业中的门店
- Admin端可以管理所有状态的门店
- 门店图片上传最大10MB
- 附近门店搜索最大半径50公里

### 8. 统计管理
- 账号统计接口返回实时数据
- 定时任务支持手动触发,方便测试
- 定时任务有完善的日志记录
- 课程统计和教练统计会检查是否已统计,避免重复

### 9. 权限管理
- 权限管理为RBAC模型
- 管理员(userId=1)默认拥有所有权限
- 其他用户权限通过角色关联查询
- 支持菜单权限、按钮权限、API权限三级权限

### 10. 文件上传
- 头像上传: 最大5MB
- 门店图片: 最大10MB
- 支持格式: jpg/jpeg/png/gif
- 所有文件上传到MinIO对象存储

---

## 常见问题FAQ

### Q1: 如何在Knife4j中设置JWT认证?
**A**:
1. 先调用登录接口获取token
2. 点击页面右上角🔒Authorize按钮
3. 在弹出框中输入token(不需要Bearer前缀)
4. 点击Authorize确认
5. 现在可以调用需要认证的接口了

### Q2: 为什么我的token过期了?
**A**: Token有效期为24小时,过期后需要重新登录获取新token。如果提前登出,token会被加入黑名单立即失效。

### Q3: 验证码是多少?
**A**: 开发模式下,所有验证码统一为 `123456`。

### Q4: 如何成为教练?
**A**:
1. 注册普通用户账号
2. 完善个人信息
3. 提交教练认证申请
4. 等待Admin审核通过
5. 审核通过后自动获得教练角色

### Q5: 教练离职后还能恢复吗?
**A**: 教练离职后角色被移除,需要重新提交教练认证申请。

### Q6: 如何查找附近的门店?
**A**: 调用 `GET /app/gym-store/nearby` 接口,提供当前位置的经纬度,系统会返回指定半径内的门店,按距离排序。

### Q7: 定时任务什么时候执行?
**A**:
- 课程统计: 每天凌晨1点
- 教练统计: 每天凌晨2点
- 课程状态检查: 每小时整点
- 临时文件清理: 每天凌晨3点

### Q8: 如何上传图片到MinIO?
**A**: 调用相应的上传接口(头像上传/门店图片上传),使用multipart/form-data方式,参数名为file。

### Q9: 为什么我的接口返回401?
**A**: 401表示未认证,请检查:
1. 是否已登录获取token
2. 是否在Knife4j中设置了认证
3. token是否过期
4. 是否调用了需要认证的接口

### Q10: 如何测试完整的业务流程?
**A**: 参考本文档的"完整业务流程测试"章节,按步骤操作即可。

---

## 📚 更新日志

### v2.0 (2025-10-16)
- ✅ 根据实际已实现功能重新编写文档
- ✅ 新增**门店管理**模块完整文档(App端6个接口, Admin端11个接口)
- ✅ 完善所有模块的接口说明和请求示例
- ✅ 新增常见问题FAQ章节
- ✅ 优化文档结构和排版
- ✅ 新增快速开始章节
- ✅ 完善测试账号说明
- ✅ 所有接口标记是否需要Token认证
- ✅ 统一开发模式说明为【开发模式】格式

### v1.0 (2025-10-15)
- ✅ 初始版本
- ✅ 包含用户认证、教练管理、咨询、日程等核心功能
- ✅ 新增统计管理和权限管理模块

---

## 🎉 总结

本文档提供了健身平台所有核心功能的完整接口测试指南,包括:

- ✨ **8个App端功能模块** - 用户认证、个人信息、角色管理、教练认证、教练离职、教练咨询、教练日程管理、门店信息
- 🛠️ **5个Admin端管理模块** - 用户管理、教练管理、门店管理、统计管理、权限管理
- 📝 **5个完整业务流程** - 新用户注册到教练认证、用户预约教练咨询、教练日程变更审核、教练离职申请、统计管理与权限验证
- 🔐 **完整的认证和权限控制** - JWT认证、角色权限、状态管理、RBAC权限体系
- 📊 **统计分析功能** - 账号统计、课程统计、教练统计、定时任务、用户登录日志
- 🏪 **门店管理功能** - 门店CRUD、附近门店搜索、门店详情查询、教练课程信息

### 接口统计
- App端接口: **40+ 个**
- Admin端接口: **50+ 个**
- 业务流程: **5 个**
- 测试账号: **4 个**

通过本文档,您可以完整测试健身平台的**用户管理、教练管理、咨询服务、日程管理、统计分析、权限控制、门店管理**等核心功能模块。

---

**技术支持**:
- Knife4j文档: http://localhost:8080/doc.html (Admin) / http://localhost:8081/doc.html (App)
- 项目架构: Spring Boot 3.0.5 + MyBatis-Plus 3.5.3.1
- 对象存储: MinIO
- 缓存/Session: Redis

**文档作者**: 健身平台开发团队
**文档维护**: 持续更新中...
